<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/x-icon" href="rtp.png" />
  <title>Civic Complaint Management System</title>
  <style>
    * {
      box-sizing: border-box;
    }

.logo {
  display: block;
  margin: 0 auto 10px auto;
  width: 80px;
  height: auto;
}

.tagline {
  text-align: center;
  color: #666;
  margin-bottom: 20px;
  font-size: 14px;
}

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body.dark {
      background-color: #121212;
      color: #e0e0e0;
    }

    header,
    footer {
      background-color: #003366;
      color: #fff;
      text-align: center;
      padding: 1.2rem;
    }

    .container {
      background: #fff;
      padding: 20px;
      max-width: 500px;
      margin: 30px auto;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    body.dark .container {
      background: #1e1e1e;
    }

    h3 {
      text-align: center;
      color: #003366;
    }

    body.dark h3 {
      color: #90caf9;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    input[type="file"] {
      padding: 5px;
    }

    button {
      padding: 10px 15px;
      margin: 8px 5px 0 0;
      border: none;
      border-radius: 6px;
      background-color: #007acc;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #005f99;
    }

    .spinner {
      display: none;
      margin-top: 10px;
      text-align: center;
    }

    .spinner::after {
      content: "";
      display: inline-block;
      width: 25px;
      height: 25px;
      border: 3px solid #ccc;
      border-top-color: #007acc;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    #imagePreview {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 6px;
    }

    .status {
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 5px;
      display: inline-block;
      margin-top: 10px;
    }

    .pending {
      background-color: #ffcccc;
      color: #cc0000;
    }

    .resolved {
      background-color: #ccffcc;
      color: #006600;
    }

    .toggle-dark {
      position: fixed;
      top: 15px;
      right: 20px;
      background: #444;
      color: white;
      padding: 6px 10px;
      border-radius: 20px;
      cursor: pointer;
    }

    @media (max-width: 600px) {
      .container {
        width: 90%;
        padding: 15px;
      }

      button {
        width: 100%;
        margin-top: 10px;
      }

      .toggle-dark {
        top: 10px;
        right: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="toggle-dark" onclick="toggleDarkMode()">ðŸŒ™</div>

  <header>
    <h2>Civic Complaint Management System</h2>
  </header>

 <div class="container" id="registration">
  <img src="C:\Users\manoj\Desktop\RTP\rtp2.png" alt="Civic Logo" class="logo" />
  <h3>Welcome to Civic Complaint Portal</h3>
  <p class="tagline">Report your civic issues easily and track them anytime!</p>
  
  <input type="text" id="phoneNumber" placeholder="Enter Phone Number" />
  <button onclick="sendOTP()">Send OTP</button>
  
  <input type="text" id="otp" placeholder="Enter OTP" />
  <button onclick="login()">Login</button>
</div>

  <div class="container" id="dashboard" style="display: none;">
    <h3>Dashboard</h3>
    <button onclick="showFileComplaint()">File Complaint</button>
    <button onclick="showTrackComplaint()">Track Complaint</button>
    <button onclick="showAllComplaints()">All Complaints</button>
  </div>

  <div class="container" id="fileComplaint" style="display: none;">
    <h3>File a Complaint</h3>
    <input type="file" id="image" accept="image/*" onchange="previewImage()" />
    <img id="imagePreview" />
    <input type="text" id="address" placeholder="Enter Address" />
    <input type="text" id="location" placeholder="Enter Location" />
<label for="department">Select Department:</label>
<select id="department" name="department" required>
  <option value="">--Select--</option>
  <option value="Road Department">Road Department</option>
  <option value="Water Department">Water Department</option>
  <option value="Electricity Department">Electricity Department</option>
</select>

    <select id="category">
      <option value="">Select Category</option>
      <option value="Road">Road</option>
      <option value="Water">Water</option>
      <option value="Electricity">Electricity</option>
      <option value="Garbage">Garbage</option>
    </select>
    <button onclick="submitComplaint()">Submit</button>
    <div class="spinner" id="submitSpinner"></div>
    <button onclick="goBack()">Back</button>
  </div>

  <div class="container" id="trackComplaint" style="display: none;">
    <h3>Track Complaint</h3>
    <input type="text" id="trackId" placeholder="Enter Complaint ID" />
    <button onclick="trackComplaint()">Track</button>
    <div class="spinner" id="trackSpinner"></div>
    <div id="trackStatus"></div>
    <button onclick="goBack()">Back</button>
  </div>

 <div class="container" id="allComplaints" style="display: none;">
  <h2>All Complaints</h2>
  <ul></ul> <!-- We will append complaints here -->

    <button onclick="goBack()">Back</button>
  </div>

  <script>
    function toggleDarkMode() {
      document.body.classList.toggle("dark");
    }

    function sendOTP() {
      const phone = document.getElementById("phoneNumber").value;
      if (phone.length < 10 || isNaN(phone)) {
        alert("Enter a valid phone number.");
        return;
      }
      alert("OTP sent to " + phone);
    }

   function login() {
  const otp = document.getElementById("otp").value;
  if (otp === "") {
    alert("Please enter the OTP.");
    return;
  }

  alert("Login successful!");
  document.getElementById("registration").style.display = "none";

  // âœ… Show the dashboard only after login
  document.getElementById("dashboard").style.display = "block";
}

    function showFileComplaint() {
      hideAll();
      document.getElementById("fileComplaint").style.display = "block";
    }

    function showTrackComplaint() {
      hideAll();
      document.getElementById("trackComplaint").style.display = "block";
    }

    function showAllComplaints() {
      hideAll();
      document.getElementById("allComplaints").style.display = "block";
    }

    function previewImage() {
  const file = document.getElementById("image").files[0];
  const preview = document.getElementById("imagePreview");
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      preview.src = e.target.result;
      preview.style.display = "block";
    };
    reader.readAsDataURL(file);
  } else {
    preview.src = "";
    preview.style.display = "none";
  }
}

function submitComplaint() {
  const address = document.getElementById("address").value.trim();
  const location = document.getElementById("location").value.trim();
  const category = document.getElementById("category").value;
  const department = document.getElementById("department").value; // Get the department selected by the user

  if (!address || !location || !category || !department) {
    alert("Please fill in all fields.");
    return;
  }

  const spinner = document.getElementById("submitSpinner");
  spinner.style.display = "block";

  setTimeout(() => {
    spinner.style.display = "none";
    const complaintId = "CMP" + Math.floor(Math.random() * 10000);
    alert("Complaint filed! Your ID: " + complaintId);

    // Prepare email content
    const emailContent = `
      Complaint ID: ${complaintId}
      Department: ${department}
      Category: ${category}
      Address: ${address}
      Location: ${location}
    `;

    // Send the email to the department (for now, it's a static email)
    sendEmailToDepartment(emailContent);
  }, 1500);
}

function sendEmailToDepartment(content) {
  emailjs.init('f3xog26_KKwDKl_mK'); // Replace with your EmailJS userID

  const templateParams = {
    to_email: 'manojbabu.ch22@gmail.com', // Email where complaints are sent
    subject: 'New Civic Complaint Filed',
    message: content
  };

  emailjs.send('service_alzj1e8', 'template_enk7kqm', templateParams)
    .then((response) => {
      console.log('Email sent successfully', response);
    }, (error) => {
      console.error('Error sending email', error);
    });
}



function confirmSubmission() {
  if (!confirm("Do you want to submit the complaint?")) return;

  const spinner = document.getElementById("spinner");
  spinner.style.display = "inline-block";

  // Simulate loading
  setTimeout(() => {
    spinner.style.display = "none";

    // Get user input (you can later extend this to real values)
    const category = document.querySelector("#fileComplaint select").value;
    const description = document.querySelector("#fileComplaint textarea").value;

    // Create new list item
    const complaintItem = document.createElement("li");
    complaintItem.innerHTML = `${category} - ${description} - <span class="status pending">Pending</span>`;

    // Append to 'allComplaints'
    document.querySelector("#allComplaints ul").appendChild(complaintItem);

    // Clear form
    document.querySelector("#fileComplaint textarea").value = "";

    alert("Complaint submitted successfully!");
  }, 2000);
}


    function trackComplaint() {
      const id = document.getElementById("trackId").value.trim();
      const spinner = document.getElementById("trackSpinner");
      const statusDiv = document.getElementById("trackStatus");

      if (id === "") {
        alert("Enter a valid Complaint ID.");
        return;
      }

      spinner.style.display = "block";
      statusDiv.innerHTML = "";

      setTimeout(() => {
        spinner.style.display = "none";
        const status = Math.random() > 0.5 ? "In Progress" : "Resolved";
        statusDiv.innerHTML = `<span class="status ${status === "Resolved" ? "resolved" : "pending"}">${status}</span>`;
      }, 1000);
    }

    function goBack() {
      hideAll();
      document.getElementById("dashboard").style.display = "block";
    }

    function hideAll() {
      document.getElementById("fileComplaint").style.display = "none";
      document.getElementById("trackComplaint").style.display = "none";
      document.getElementById("allComplaints").style.display = "none";
    }
  </script>
</body>
</html>
